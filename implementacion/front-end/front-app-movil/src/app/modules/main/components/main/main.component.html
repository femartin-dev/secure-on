<!-- Drawer toggle (hidden checkbox trick) -->
<input class="peer hidden" id="drawer-toggle" type="checkbox" #drawerToggle />

<!-- Main Screen Container -->
<div class="relative flex h-screen w-full flex-col bg-background-dark transition-transform duration-300 ease-out peer-checked:scale-[0.92] peer-checked:opacity-40 overflow-hidden">

  <!-- Video Background -->
  <div class="absolute inset-0 z-0 h-full w-full pointer-events-none">
    <video #bgVideo autoplay loop muted playsinline class="absolute inset-0 h-full w-full object-cover">
      <source src="assets/securion-bg-video.mp4" type="video/mp4" />
    </video>
    <div class="absolute inset-0 bg-blue-900/60 mix-blend-overlay"></div>
    <div class="absolute inset-0 bg-[#060b14]/70 mix-blend-multiply"></div>
    <div class="absolute inset-0 bg-panic-gradient"></div>
  </div>

  <!-- Header -->
  <header class="relative z-20 flex w-full items-center justify-between px-4 pt-1 pb-2">
    <label class="group flex size-12 cursor-pointer items-center justify-center rounded-full text-white transition-colors hover:bg-white/10 active:bg-white/20" for="drawer-toggle">
      <span class="material-symbols-outlined text-[28px]">menu</span>
    </label>
    <div class="h-32 rounded-3xl bg-white/5 flex items-center justify-center border border-white/10 shadow-inner backdrop-blur-md w-48">
      <img alt="Secureon Logo" class="h-auto object-contain w-80" src="assets/secureon-logo.png" />
    </div>
    <div class="size-12"></div>
  </header>

  <!-- Main Content: Panic Button -->
  <main class="relative z-10 flex flex-grow flex-col items-center justify-center px-6 pb-20">
    <div class="flex flex-col items-center gap-10">

      <!-- Panic Button -->
      <button
        class="group relative flex size-64 cursor-pointer flex-col items-center justify-center rounded-full bg-panic text-white shadow-[0_8px_30px_rgba(0,0,0,0.5)] transition-all active:scale-95 active:shadow-inner border border-red-400/20 hover:bg-red-700 no-select outline-none"
        (mousedown)="onPanicStart()"
        (mouseup)="onPanicEnd()"
        (mouseleave)="onPanicEnd()"
        (touchstart)="onPanicStart()"
        (touchend)="onPanicEnd()"
        (touchcancel)="onPanicEnd()"
      >
        <!-- Outer rings -->
        <div class="absolute -inset-4 rounded-full border border-red-500/20 pointer-events-none"></div>
        <div class="absolute -inset-10 rounded-full border border-red-500/5 bg-red-900/5 pointer-events-none"></div>

        <!-- SVG Loading Circle -->
        <svg class="absolute inset-0 size-full -rotate-90 pointer-events-none" viewBox="0 0 100 100">
          <circle class="loading-track" cx="50" cy="50" r="48" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="4"></circle>
          <circle
            class="loading-fill drop-shadow-[0_0_8px_rgba(255,255,255,0.6)]"
            cx="50" cy="50" r="48" fill="none" stroke="white" stroke-linecap="round" stroke-width="4"
            [style.stroke-dasharray]="'302'"
            [style.stroke-dashoffset]="panicProgress"
            [style.opacity]="pressing ? '1' : '0'"
            [style.transition]="pressing ? 'stroke-dashoffset 3s linear, opacity 0.1s ease-in' : 'stroke-dashoffset 0.25s ease-out, opacity 0.2s ease-out'"
          ></circle>
        </svg>

        <span class="material-symbols-outlined text-[72px] mb-1 drop-shadow-md group-active:opacity-90 relative z-10">e911_emergency</span>
        <span class="text-3xl font-black tracking-[0.2em] drop-shadow-md relative z-10">ALARMA</span>
      </button>

      <p class="text-blue-100/70 text-sm font-medium tracking-wider uppercase text-center max-w-[240px]">
        Mantenga presionado por 3 segundos para activar
      </p>
    </div>
  </main>

  <!-- Footer -->
  <footer class="absolute bottom-0 left-0 w-full pb-8 pt-4 text-center z-20">
    <div class="flex flex-col items-center gap-4">
      <img alt="Securitas Logo" class="h-12 w-auto opacity-60 hover:opacity-100 transition-opacity" src="assets/securitas-certified-partner.png" />
      <div class="flex flex-col items-center gap-1">
        <p class="text-[7px] text-white/30 uppercase tracking-widest text-center lg:text-xs">© 2024 SECURITAS. TODOS LOS DERECHOS RESERVADOS.</p>
        <p class="text-[5px] text-white/20 font-mono">v1.0.2</p>
      </div>
    </div>
  </footer>
</div>

<!-- Drawer Overlay -->
<label class="fixed inset-0 z-40 hidden h-full w-full bg-black/60 backdrop-blur-sm peer-checked:block transition-opacity" for="drawer-toggle"></label>

<!-- Drawer Sidebar -->
<aside class="fixed left-0 top-0 z-50 h-full w-[80%] max-w-[320px] -translate-x-full flex-col bg-surface shadow-2xl transition-transform duration-300 ease-out peer-checked:translate-x-0 border-r border-white/5">

  <!-- Drawer Header -->
  <div class="flex items-center justify-between px-6 pt-12 pb-6 border-b border-white/5">
    <h2 class="text-xl font-medium text-white tracking-tight">Menú</h2>
    <label class="flex size-10 cursor-pointer items-center justify-center rounded-full text-white/70 hover:bg-white/5 hover:text-white" for="drawer-toggle">
      <span class="material-symbols-outlined">close</span>
    </label>
  </div>

  <!-- Drawer Items -->
  <div class="flex flex-col py-4">
    <a class="flex items-center gap-4 px-6 py-4 text-white hover:bg-white/5 transition-colors cursor-pointer" (click)="closeDrawerAndNavigate('/main')">
      <span class="material-symbols-outlined text-gray-400">account_circle</span>
      <div class="flex flex-col">
        <span class="text-base font-medium">Perfil</span>
        <span class="text-xs text-gray-400">{{ currentUser?.nombre || 'Usuario' }}</span>
      </div>
    </a>
    <a class="flex items-center gap-4 px-6 py-4 text-white hover:bg-white/5 transition-colors cursor-pointer" (click)="closeDrawerAndNavigate('/settings')">
      <span class="material-symbols-outlined text-gray-400">settings</span>
      <span class="text-base font-medium">Configuración</span>
    </a>
    <a class="flex items-center gap-4 px-6 py-4 text-white hover:bg-white/5 transition-colors cursor-pointer" (click)="closeDrawerAndNavigate('/main')">
      <span class="material-symbols-outlined text-gray-400">history</span>
      <span class="text-base font-medium">Historial</span>
    </a>
    <a class="flex items-center gap-4 px-6 py-4 text-white hover:bg-white/5 transition-colors cursor-pointer">
      <span class="material-symbols-outlined text-gray-400">contact_support</span>
      <span class="text-base font-medium">Soporte</span>
    </a>
  </div>

  <!-- Drawer Footer Warning -->
  <div class="mt-auto p-6 border-t border-white/5">
    <div class="flex items-start gap-3 rounded-lg bg-red-900/20 px-4 py-3 border border-red-500/10">
      <span class="material-symbols-outlined text-red-400 text-xl mt-0.5">info</span>
      <p class="text-xs text-red-200/80 leading-relaxed">El uso indebido de este botón puede resultar en sanciones. Úselo solo en emergencias reales.</p>
    </div>

    <!-- Logout -->
    <button (click)="logout()" class="mt-4 w-full flex items-center justify-center gap-2 py-3 rounded-lg text-red-400 hover:bg-red-900/20 transition-colors text-sm font-medium">
      <span class="material-symbols-outlined text-lg">logout</span>
      Cerrar sesión
    </button>
  </div>
</aside>
