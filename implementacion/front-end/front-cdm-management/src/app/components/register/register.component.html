<!-- Main Container -->
<div class="relative flex min-h-screen w-full items-center flex-col overflow-x-hidden mx-auto bg-background-light dark:bg-background-dark shadow-2xl max-w-[1280px]">

  <!-- Top App Bar -->
  <header class="flex w-full items-center px-4 py-3 justify-between sticky min-[800px]:max-w-[800px] top-0 z-50 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md border-b border-gray-200 dark:border-border-dark/30">
    <button
      type="button"
      (click)="goBack()"
      class="text-gray-900 dark:text-white flex size-10 shrink-0 min-[800px]:hidden items-center justify-center rounded-full hover:bg-gray-200 dark:hover:bg-white/10 transition-colors"
    >
      <span class="material-symbols-outlined">arrow_back_ios_new</span>
    </button>
    <h1 class="text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-10 text-gray-900 dark:text-white font-display">
      Registro de Operador
    </h1>
  </header>

  <!-- Content Area -->
  <main class="flex-1 flex flex-col pb-6 min-[800px]:max-w-[800px] w-full">

    <!-- Hero / Context Image -->
    <div class="px-4 py-4 px-6">
      <div class="w-full h-[140px] rounded-xl bg-cover bg-center relative overflow-hidden shadow-lg border border-gray-200 dark:border-border-dark/50"
        style="background: linear-gradient(135deg, #183daa 0%, #1c1f26 100%);">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/80 to-background-dark/80 mix-blend-multiply"></div>
        <div class="absolute inset-0 flex flex-col justify-end p-4">
          <div class="flex items-center gap-2 text-white/90 mb-1">
            <img src="assets/securion-iso-logo.png" alt="Secureon" class="w-4 h-5 object-contain invert" />
            <span class="text-xs font-bold uppercase tracking-wider text-white/70">Secure ON</span>
          </div>
          <h2 class="text-white text-xl font-bold leading-tight">Creación de Cuenta</h2>
        </div>
      </div>
    </div>

    <!-- Intro Text -->
    <div class="px-4 pb-2 px-6">
      <p class="text-gray-600 dark:text-text-secondary text-sm font-normal leading-normal text-center">
        Ingrese los datos del nuevo operador para darle acceso al centro de monitoreo.
      </p>
    </div>

    <!-- Error Alert -->
    <div
      *ngIf="error"
      #errorAlert
      tabindex="-1"
      role="alert"
      aria-live="assertive"
      class="mx-6 p-4 mb-4 bg-red-500/10 border border-red-500/30 rounded-lg text-red-600 dark:text-red-400 text-sm"
    >
      {{ error }}
    </div>

    <!-- Registration Form -->
    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="w-full px-4 py-4 grid grid-cols-1 justify-center min-[500px]:grid-cols-2 gap-5 px-6 min-[800px]:max-w-[800px]">

      <!-- Nombre -->
      <div class="flex flex-col w-full sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Nombre</label>
        <input
          formControlName="firstName"
          type="text"
          placeholder="Juan"
          class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 px-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
        />
        <div *ngIf="submitted && f['firstName'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['firstName'].errors['required']">Nombre es requerido</p>
        </div>
      </div>

      <!-- Apellido -->
      <div class="flex flex-col w-full sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Apellido</label>
        <input
          formControlName="lastName"
          type="text"
          placeholder="Pérez"
          class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 px-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
        />
        <div *ngIf="submitted && f['lastName'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['lastName'].errors['required']">Apellido es requerido</p>
        </div>
      </div>

      <!-- Teléfono -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Teléfono</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">call</span>
          <input
            formControlName="phone"
            type="tel"
            placeholder="+54 11 1234 5678"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
        </div>
        <div *ngIf="submitted && f['phone'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['phone'].errors['required']">Teléfono es requerido</p>
        </div>
      </div>

      <!-- Email -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Email</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">mail</span>
          <input
            formControlName="email"
            type="email"
            placeholder="ejemplo@secureon.com"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
        </div>
        <div *ngIf="submitted && f['email'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['email'].errors['required']">Email es requerido</p>
          <p *ngIf="f['email'].errors['email']">Email inválido</p>
        </div>
      </div>

      <!-- Dirección -->
      <div class="flex flex-col w-full min-[500px]:col-span-2">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Dirección</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">location_on</span>
          <input
            formControlName="address"
            type="text"
            placeholder="Calle Falsa 123, Ciudad"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
        </div>
        <div *ngIf="submitted && f['address'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['address'].errors['required']">Dirección es requerida</p>
        </div>
      </div>

      <!-- Legajo -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Legajo</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">badge</span>
          <input
            formControlName="legajo"
            type="number"
            inputmode="numeric"
            placeholder="12345"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-4 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
        </div>
        <div *ngIf="submitted && f['legajo'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['legajo'].errors['required']">Legajo es requerido</p>
          <p *ngIf="f['legajo'].errors['pattern']">Legajo debe ser numérico</p>
        </div>
      </div>

      <!-- Supervisor -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Supervisor</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">supervisor_account</span>
          <select
            formControlName="supervisorId"
            title="Supervisor"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-10 text-base transition-all shadow-sm appearance-none cursor-pointer"
          >
            <option value="" disabled class="text-gray-400">Seleccione un supervisor</option>
            <option *ngFor="let supervisor of supervisors" [value]="supervisor.id">
              {{ getSupervisorDisplayName(supervisor) }}
            </option>
          </select>
          <span class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary pointer-events-none material-symbols-outlined" style="font-size: 20px;">expand_more</span>
        </div>
        <div *ngIf="submitted && f['supervisorId'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['supervisorId'].errors['required']">Supervisor es requerido</p>
        </div>
      </div>

      <!-- Contraseña -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Contraseña</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">lock</span>
          <input
            formControlName="password"
            [type]="showPassword ? 'text' : 'password'"
            placeholder="••••••••"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-11 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility('password')"
            class="absolute right-0 top-0 bottom-0 px-3 flex items-center justify-center text-gray-400 dark:text-text-secondary hover:text-primary dark:hover:text-white transition-colors focus:outline-none"
          >
            <span class="material-symbols-outlined" style="font-size: 20px;">{{ showPassword ? 'visibility_off' : 'visibility' }}</span>
          </button>
        </div>
        <div *ngIf="submitted && f['password'].errors" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['password'].errors['required']">Contraseña es requerida</p>
          <p *ngIf="f['password'].errors['minlength']">Contraseña debe tener al menos 8 caracteres</p>
        </div>
      </div>

      <!-- Confirmar Contraseña -->
      <div class="flex flex-col w-full min-[500px]:col-span-2 sm:col-span-1">
        <label class="text-sm font-medium leading-normal pb-2 ml-1 text-gray-700 dark:text-white">Confirmar Contraseña</label>
        <div class="relative group">
          <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 dark:text-text-secondary group-focus-within:text-primary transition-colors material-symbols-outlined" style="font-size: 20px;">encrypted</span>
          <input
            formControlName="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            placeholder="••••••••"
            class="form-input flex w-full rounded-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-gray-300 dark:border-border-dark bg-white dark:bg-surface-dark focus:border-primary h-12 pl-11 pr-11 placeholder:text-gray-400 dark:placeholder:text-text-secondary text-base transition-all shadow-sm"
          />
          <button
            type="button"
            (click)="togglePasswordVisibility('confirmPassword')"
            class="absolute right-0 top-0 bottom-0 px-3 flex items-center justify-center text-gray-400 dark:text-text-secondary hover:text-primary dark:hover:text-white transition-colors focus:outline-none"
          >
            <span class="material-symbols-outlined" style="font-size: 20px;">{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</span>
          </button>
        </div>
        <div *ngIf="submitted && (f['confirmPassword'].errors || form.errors?.['passwordMismatch'])" class="text-red-500 text-xs mt-1">
          <p *ngIf="f['confirmPassword'].errors?.['required']">Confirmación de contraseña es requerida</p>
          <p *ngIf="form.errors?.['passwordMismatch']">Las contraseñas no coinciden</p>
        </div>
      </div>

    </form>
  </main>

  <!-- Action Buttons -->
  <div class="flex w-full mt-4 px-4 pb-8 flex-col gap-3 sm:flex-row sm:gap-4 justify-center mx-auto min-[800px]:max-w-[800px]">
    <button
      (click)="onSubmit()"
      [disabled]="loading"
      class="flex w-full items-center justify-center rounded-lg bg-primary hover:bg-primary-hover h-12 px-5 transition-all focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark shadow-lg shadow-primary/20 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
    >
      <span *ngIf="!loading" class="text-white text-base font-bold tracking-wide">Aceptar</span>
      <span *ngIf="loading" class="text-white text-base font-bold animate-spin">⟳</span>
    </button>
    <button
      type="button"
      (click)="goBack()"
      class="flex w-full items-center justify-center rounded-lg border border-primary bg-white dark:bg-surface-dark hover:bg-gray-50 dark:hover:bg-white/10 h-12 px-5 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark"
    >
      <span class="text-primary text-base font-bold tracking-wide">Cancelar</span>
    </button>
  </div>

  <!-- Bottom safe area spacer -->
  <div class="h-4 w-full bg-transparent"></div>
</div>
